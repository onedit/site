<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../src/helpers/textureFX.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/LS.Animation.html">LS.Animation</a></li>
                                <li><a href="../classes/LS.Animation.Take.html">LS.Animation.Take</a></li>
                                <li><a href="../classes/LS.Animation.Track.html">LS.Animation.Track</a></li>
                                <li><a href="../classes/LS.Collision.html">LS.Collision</a></li>
                                <li><a href="../classes/LS.Component.html">LS.Component</a></li>
                                <li><a href="../classes/LS.ComponentContainer.html">LS.ComponentContainer</a></li>
                                <li><a href="../classes/LS.Components.Camera.html">LS.Components.Camera</a></li>
                                <li><a href="../classes/LS.Components.CameraController.html">LS.Components.CameraController</a></li>
                                <li><a href="../classes/LS.Components.CameraFX.html">LS.Components.CameraFX</a></li>
                                <li><a href="../classes/LS.Components.CustomData.html">LS.Components.CustomData</a></li>
                                <li><a href="../classes/LS.Components.FollowNode.html">LS.Components.FollowNode</a></li>
                                <li><a href="../classes/LS.Components.FrameFX.html">LS.Components.FrameFX</a></li>
                                <li><a href="../classes/LS.Components.FXGraphComponent.html">LS.Components.FXGraphComponent</a></li>
                                <li><a href="../classes/LS.Components.GeometricPrimitive.html">LS.Components.GeometricPrimitive</a></li>
                                <li><a href="../classes/LS.Components.GraphComponent.html">LS.Components.GraphComponent</a></li>
                                <li><a href="../classes/LS.Components.MeshRenderer.html">LS.Components.MeshRenderer</a></li>
                                <li><a href="../classes/LS.Components.NodeManipulator.html">LS.Components.NodeManipulator</a></li>
                                <li><a href="../classes/LS.Components.PlayAnimation.html">LS.Components.PlayAnimation</a></li>
                                <li><a href="../classes/LS.Components.Poser.html">LS.Components.Poser</a></li>
                                <li><a href="../classes/LS.Components.RealtimeReflector.html">LS.Components.RealtimeReflector</a></li>
                                <li><a href="../classes/LS.Components.Rotator.html">LS.Components.Rotator</a></li>
                                <li><a href="../classes/LS.Components.Script.html">LS.Components.Script</a></li>
                                <li><a href="../classes/LS.Components.SkinDeformer.html">LS.Components.SkinDeformer</a></li>
                                <li><a href="../classes/LS.Components.Spherize.html">LS.Components.Spherize</a></li>
                                <li><a href="../classes/LS.Components.Target.html">LS.Components.Target</a></li>
                                <li><a href="../classes/LS.Components.TextureFX.html">LS.Components.TextureFX</a></li>
                                <li><a href="../classes/LS.Components.Transform.html">LS.Components.Transform</a></li>
                                <li><a href="../classes/LS.Components.VRCameraController.html">LS.Components.VRCameraController</a></li>
                                <li><a href="../classes/LS.CompositePattern.html">LS.CompositePattern</a></li>
                                <li><a href="../classes/LS.Draw.html">LS.Draw</a></li>
                                <li><a href="../classes/LS.Formats.html">LS.Formats</a></li>
                                <li><a href="../classes/LS.Input.html">LS.Input</a></li>
                                <li><a href="../classes/LS.InteractiveController.html">LS.InteractiveController</a></li>
                                <li><a href="../classes/LS.Knob.html">LS.Knob</a></li>
                                <li><a href="../classes/LS.Light.html">LS.Light</a></li>
                                <li><a href="../classes/LS.LightFX.html">LS.LightFX</a></li>
                                <li><a href="../classes/LS.LS.html">LS.LS</a></li>
                                <li><a href="../classes/LS.LScript.html">LS.LScript</a></li>
                                <li><a href="../classes/LS.Material.html">LS.Material</a></li>
                                <li><a href="../classes/LS.Pack.html">LS.Pack</a></li>
                                <li><a href="../classes/LS.Physics.html">LS.Physics</a></li>
                                <li><a href="../classes/LS.PhysicsInstance.html">LS.PhysicsInstance</a></li>
                                <li><a href="../classes/LS.Picking.html">LS.Picking</a></li>
                                <li><a href="../classes/LS.Player.html">LS.Player</a></li>
                                <li><a href="../classes/LS.Prefab.html">LS.Prefab</a></li>
                                <li><a href="../classes/LS.Project.html">LS.Project</a></li>
                                <li><a href="../classes/LS.Renderer.html">LS.Renderer</a></li>
                                <li><a href="../classes/LS.RenderInstance.html">LS.RenderInstance</a></li>
                                <li><a href="../classes/LS.RenderSettings.html">LS.RenderSettings</a></li>
                                <li><a href="../classes/LS.Resource.html">LS.Resource</a></li>
                                <li><a href="../classes/LS.ResourcesManager.html">LS.ResourcesManager</a></li>
                                <li><a href="../classes/LS.SceneNode.html">LS.SceneNode</a></li>
                                <li><a href="../classes/LS.SceneTree.html">LS.SceneTree</a></li>
                                <li><a href="../classes/LS.ShaderCode.html">LS.ShaderCode</a></li>
                                <li><a href="../classes/LS.ShaderMaterial.html">LS.ShaderMaterial</a></li>
                                <li><a href="../classes/LS.ShaderQuery.html">LS.ShaderQuery</a></li>
                                <li><a href="../classes/LS.ShadersManager.html">LS.ShadersManager</a></li>
                                <li><a href="../classes/LS.StandardMaterial.html">LS.StandardMaterial</a></li>
                                <li><a href="../classes/LS.WBin.html">LS.WBin</a></li>
                                <li><a href="../classes/LSQ.html">LSQ</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/LS.html">LS</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../src/helpers/textureFX.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//Work in progress

/**
* helps apply basic effects to a texture with as fewer render calls as possible with low memory footprint
* used by CameraFX but also available for any other use
* @class TextureFX
*/
function TextureFX( o )
{
	this.apply_fxaa = false;
	this.filter = true;
	this.fx = [];

	this._uniforms = { u_aspect: 1, u_viewport: vec2.create(), u_iviewport: vec2.create(), u_texture: 0, u_texture_depth: 1, u_random: vec2.create() };
	if(o)
		this.configure(o);
}

TextureFX.available_fx = {
	&quot;brightness_contrast&quot;: {
		name: &quot;Brightness &amp; Contrast&quot;,
		uniforms: {
			brightness: { name: &quot;u_brightness&quot;, type: &quot;float&quot;, value: 1, step: 0.01 },
			contrast: { name: &quot;u_contrast&quot;, type: &quot;float&quot;, value: 1, step: 0.01 }
		},
		code:&quot;color.xyz = (color.xyz * u_brightness@ - vec3(0.5)) * u_contrast@ + vec3(0.5);&quot;
	},
	&quot;invert&quot;: {
		name: &quot;Invert color&quot;,
		code:&quot;color.xyz = vec3(1.0) - color.xyz;&quot;
	},
	&quot;threshold&quot;: {
		name: &quot;Threshold&quot;,
		uniforms: {
			threshold: { name: &quot;u_threshold&quot;, type: &quot;float&quot;, value: 0.5, min: 0, max: 2, step: 0.01 },
			threshold_width: { name: &quot;u_threshold_width&quot;, type: &quot;float&quot;, value: 0.01, min: 0, max: 1, step: 0.001 }
		},
		code:&quot;color.xyz = vec3( smoothstep( u_threshold@ - u_threshold_width@ * 0.5, u_threshold@ + u_threshold_width@ * 0.5,  length(color.xyz) ));&quot;
	},
	&quot;colorize&quot;: {
		name: &quot;Colorize&quot;,
		uniforms: {
			colorize: { name: &quot;u_colorize&quot;, type: &quot;color3&quot;, value: [1,1,1] },
			vibrance: { name: &quot;u_vibrance&quot;, type: &quot;float&quot;, value: 0.0, min: 0, max: 2, step: 0.01 }
		},
		code:&quot;color.xyz = color.xyz * (u_colorize@ + vec3(u_vibrance@ * 0.1)) * (1.0 + u_vibrance@);&quot;
	},
	&quot;color_add&quot;: {
		name: &quot;Color add&quot;,
		uniforms: {
			color_add: { name: &quot;u_coloradd&quot;, type: &quot;color3&quot;, value: [0.1,0.1,0.1] }
		},
		code:&quot;color.xyz = color.xyz + u_coloradd@;&quot;
	},
	&quot;vigneting&quot;: {
		name: &quot;Vigneting&quot;,
		uniforms: {
			radius: { name: &quot;u_radius&quot;, type: &quot;float&quot;, value: 1 },
			intensity: { name: &quot;u_vigneting&quot;, type: &quot;float&quot;, value: 1, min: 0, max: 2, step: 0.01 }
		},
		code:&quot;color.xyz = mix( color.xyz * max( 1.0 - (dist_to_center * u_radius@ / 0.7071), 0.0), color.xyz, u_vigneting@);&quot;
	},
	&quot;aberration&quot;: {
		name: &quot;Chromatic Aberration&quot;,
		pass: &quot;before&quot;,
		uniforms: {
			difraction: { name: &quot;u_difraction&quot;, type: &quot;float&quot;, value: 1 }
		},
		code: &quot;color.x = texture2D(u_texture, uv - to_center * 0.001 * u_difraction@ ).x;&quot; + 
			&quot;color.z = texture2D(u_texture, uv + to_center * 0.001 * u_difraction@ ).z;&quot;
	},
	&quot;halftone&quot;: {
		name: &quot;Halftone&quot;,
		uniforms: {
			&quot;Halftone angle&quot;: { name: &quot;u_halftone_angle&quot;, type: &quot;float&quot;, value: 0, step: 0.01 },
			&quot;Halftone size&quot;: { name: &quot;u_halftone_size&quot;, type: &quot;float&quot;, value: 1, step: 0.01 }
		},
		functions: [&quot;pattern&quot;],
		code:&quot;color.x = ( (color.x * 10.0 - 5.0) + pattern( u_halftone_angle@, u_halftone_size@ ) );&quot; + 
			&quot;color.y = ( (color.y * 10.0 - 5.0) + pattern( u_halftone_angle@ + 0.167, u_halftone_size@ ) );&quot; + 
			&quot;color.z = ( (color.z * 10.0 - 5.0) + pattern( u_halftone_angle@ + 0.333, u_halftone_size@ ) );&quot;
	},
	&quot;halftoneBN&quot;: {
		name: &quot;Halftone B/N&quot;,
		uniforms: {
			&quot;Halftone angle&quot;: { name: &quot;u_halftone_angle&quot;, type: &quot;float&quot;, value: 0, step: 0.01 },
			&quot;Halftone size&quot;: { name: &quot;u_halftone_size&quot;, type: &quot;float&quot;, value: 1, step: 0.01 }
		},
		functions: [&quot;pattern&quot;],
		code:&quot;color.xyz = vec3( (length(color.xyz) * 10.0 - 5.0) + pattern( u_halftone_angle@, u_halftone_size@ ) );&quot;
	},
	&quot;lens&quot;: {
		name: &quot;Lens Distortion&quot;,
		uniforms: {
			lens_k: { name: &quot;u_lens_k&quot;, type: &quot;float&quot;, value: -0.15 },
			lens_kcube: { name: &quot;u_lens_kcube&quot;, type: &quot;float&quot;, value: 0.8 },
			lens_scale: { name: &quot;u_lens_scale&quot;, type: &quot;float&quot;, value: 1 }
		},
		uv_code:&quot;float r2 = u_aspect * u_aspect * (uv.x-0.5) * (uv.x-0.5) + (uv.y-0.5) * (uv.y-0.5); float distort@ = 1. + r2 * (u_lens_k@ + u_lens_kcube@ * sqrt(r2)); uv = vec2( u_lens_scale@ * distort@ * (uv.x-0.5) + 0.5, u_lens_scale@  * distort@ * (uv.y-0.5) + 0.5 );&quot;
	},
	&quot;warp&quot;: {
		name: &quot;Warp&quot;,
		uniforms: {
			warp_amp: { name: &quot;u_warp_amp&quot;, type: &quot;float&quot;, value: 0.01, step: 0.001 },
			warp_texture: { name: &quot;u_warp_texture&quot;, type: &quot;sampler2D&quot;, widget: &quot;Texture&quot;, value: &quot;&quot; }
		},
		uv_code:&quot;uv = uv + u_warp_amp@ * (texture2D( u_warp_texture@, uv ).xy - vec2(0.5));&quot;
		//uv_code:&quot;uv = uv + u_warp_amp@ * (vec2(0.5) + 0.5 * vec2( sin(uv.x * u_warp_freq@) * sin(uv.y * u_warp_freq@)));&quot;
	},
	&quot;LUT&quot;: {
		name: &quot;LUT&quot;,
		functions: [&quot;LUT&quot;],
		uniforms: {
			lut_intensity: { name: &quot;u_lut_intensity&quot;, type: &quot;float&quot;, value: 1, step: 0.01 },
			lut_texture: { name: &quot;u_lut_texture&quot;, type: &quot;sampler2D&quot;, filter: &quot;nearest&quot;, wrap: &quot;clamp&quot;, widget: &quot;Texture&quot;, value: &quot;&quot; }
		},
		code:&quot;color.xyz = mix(color.xyz, LUT( color.xyz, u_lut_texture@ ), u_lut_intensity@);&quot;
		//uv_code:&quot;uv = uv + u_warp_amp@ * (vec2(0.5) + 0.5 * vec2( sin(uv.x * u_warp_freq@) * sin(uv.y * u_warp_freq@)));&quot;
	},
	&quot;pixelate&quot;: {
		name: &quot;Pixelate&quot;,
		uniforms: {
			width: { name: &quot;u_width&quot;, type: &quot;float&quot;, value: 256, step: 1, min: 1 },
			height: { name: &quot;u_height&quot;, type: &quot;float&quot;, value: 256, step: 1, min: 1 }
		},
		uv_code:&quot;uv = vec2( floor(uv.x * u_width@) / u_width@, floor(uv.y * u_height@) / u_height@ );&quot;
	},
	&quot;quantize&quot;: {
		name: &quot;Quantize&quot;,
		uniforms: {
			levels: { name: &quot;u_levels&quot;, type: &quot;float&quot;, value: 8, step: 1, min: 1 }
		},
		code:&quot;color.xyz = floor(color.xyz * u_levels@) / u_levels@;&quot;
	},
	&quot;edges&quot;: {
		name: &quot;Edges&quot;,
		uniforms: {
			&quot;Edges factor&quot;: { name: &quot;u_edges_factor&quot;, type: &quot;float&quot;, value: 1 }
		},
		code:&quot;vec4 color@ = texture2D(u_texture, uv );\n\
				vec4 color_up@ = texture2D(u_texture, uv + vec2(0., u_iviewport.y));\n\
				vec4 color_right@ = texture2D(u_texture, uv + vec2(u_iviewport.x,0.));\n\
				vec4 color_down@ = texture2D(u_texture, uv + vec2(0., -u_iviewport.y));\n\
				vec4 color_left@ = texture2D(u_texture, uv + vec2(-u_iviewport.x,0.));\n\
				color = u_edges_factor@ * (abs(color@ - color_up@) + abs(color@ - color_down@) + abs(color@ - color_left@) + abs(color@ - color_right@));&quot;
	},
	&quot;depth&quot;: {
		name: &quot;Depth&quot;,
		uniforms: {
			&quot;near&quot;: { name: &quot;u_near&quot;, type: &quot;float&quot;, value: 0.01, step: 0.1 },
			&quot;far&quot;: { name: &quot;u_far&quot;, type: &quot;float&quot;, value: 1000, step: 1 }
		},
		code:&quot;color.xyz = vec3( (2.0 * u_near@) / (u_far@ + u_near@ - texture2D(u_texture_depth, uv ).x * (u_far@ - u_near@)) );&quot;
	},
	&quot;logarithmic&quot;: {
		name: &quot;Logarithmic&quot;,
		uniforms: {
			&quot;Log. A Factor&quot;: { name: &quot;u_logfactor_a&quot;, type: &quot;float&quot;, value: 2, step: 0.01 },
			&quot;Log. B Factor&quot;: { name: &quot;u_logfactor_b&quot;, type: &quot;float&quot;, value: 2, step: 0.01 }
		},
		code:&quot;color.xyz = log( color.xyz * u_logfactor_a@ ) * u_logfactor_b@;&quot;
	},
	&quot;ditherBN&quot;: {
		name: &quot;dither B/N&quot;,
		functions: [&quot;dither&quot;],
		uniforms: {
		},
		code:&quot;color.xyz = vec3( dither( color.x ) );&quot;
	},
	&quot;dither&quot;: {
		name: &quot;Dither&quot;,
		functions: [&quot;dither&quot;],
		uniforms: {
		},
		code:&quot;color.xyz = vec3( dither( color.x ), dither( color.y ), dither( color.z ) );&quot;
	},
	&quot;gamma&quot;: {
		name: &quot;Gamma&quot;,
		uniforms: {
			&quot;Gamma&quot;: { name: &quot;u_gamma&quot;, type: &quot;float&quot;, value: 2.2, step: 0.01 }
		},
		code:&quot;color.xyz = pow( color.xyz, vec3( 1.0 / u_gamma@) );&quot;
	},
	&quot;noiseBN&quot;: {
		name: &quot;Noise B&amp;N&quot;,
		functions: [&quot;noise&quot;],
		uniforms: {
			&quot;noise&quot;: { name: &quot;u_noise&quot;, type: &quot;float&quot;, value: 0.1, step: 0.01 }
		},
		code:&quot;color.xyz += u_noise@ * vec3( noise( (u_random + v_coord) * u_viewport) );&quot;
	}
	/*
	,
	&quot;fast_edges&quot;: {
		name: &quot;Edges (fast)&quot;,
		code:&quot;color.xyz = abs( dFdx(color.xyz) ) + abs( dFdy(color.xyz) );&quot;
	}
	*/
};

TextureFX.available_functions = {
	pattern: &quot;float pattern(float angle, float size) {\n\
				float s = sin(angle * 3.1415), c = cos(angle * 3.1415);\n\
				vec2 tex = v_coord * u_viewport.xy;\n\
				vec2 point = vec2( c * tex.x - s * tex.y , s * tex.x + c * tex.y ) * size;\n\
				return (sin(point.x) * sin(point.y)) * 4.0;\n\
			}\n\
		&quot;,
	dither: &quot;float dither(float v) {\n\
				vec2 pixel = v_coord * u_viewport;\n\
				int i = int(floor(clamp(v,0.0,1.0) * 16.0 + 0.5));\n\
				if(i &lt; 1)\n\
					return 0.0;\n\
				if(i &gt;= 15)\n\
					return 1.0;\n\
				float x = floor(pixel.x);\n\
				float y = floor(pixel.y);\n\
				bool xmod4 = mod(x, 4.0) == 0.0;\n\
				bool ymod4 = mod(y, 4.0) == 0.0;\n\
				bool xmod2 = mod(x, 2.0) == 0.0;\n\
				bool ymod2 = mod(y, 2.0) == 0.0;\n\
				bool xmod4_2 = mod(x + 2.0, 4.0) == 0.0;\n\
				bool ymod4_2 = mod(y + 2.0, 4.0) == 0.0;\n\
				bool xmod2_1 = mod(x + 1.0, 2.0) == 0.0;\n\
				bool ymod2_1 = mod(y + 1.0, 2.0) == 0.0;\n\
				bool xmod4_1 = mod(x + 1.0, 4.0) == 0.0;\n\
				bool ymod4_1 = mod(y + 1.0, 4.0) == 0.0;\n\
				bool xmod4_3 = mod(x + 3.0, 4.0) == 0.0;\n\
				bool ymod4_3 = mod(y + 3.0, 4.0) == 0.0;\n\
				\n\
				if(i &lt; 9)\n\
				{\n\
					if(i &gt;= 1 &amp;&amp; xmod4 &amp;&amp; ymod4 )\n\
						return 1.0;\n\
					if(i &gt;= 2 &amp;&amp; xmod4_2 &amp;&amp; ymod4_2)\n\
						return 1.0;\n\
					if(i &gt;= 3 &amp;&amp; xmod4_2 &amp;&amp; ymod2 )\n\
						return 1.0;\n\
					if(i &gt;= 4 &amp;&amp; xmod2 &amp;&amp; ymod2 )\n\
						return 1.0;\n\
					if(i &gt;= 5 &amp;&amp; xmod4_1 &amp;&amp; ymod4_1 )\n\
						return 1.0;\n\
					if(i &gt;= 6 &amp;&amp; xmod4_3 &amp;&amp; ymod4_3 )\n\
						return 1.0;\n\
					if(i &gt;= 7 &amp;&amp; xmod4_1 &amp;&amp; ymod4_3 )\n\
						return 1.0;\n\
					if(i &gt;= 8 &amp;&amp; xmod4_3 &amp;&amp; ymod4_1 )\n\
						return 1.0;\n\
					return 0.0;\n\
				}\n\
				else\n\
				{\n\
					if(i &lt; 15 &amp;&amp; xmod4_1 &amp;&amp; ymod4 )\n\
						return 0.0;\n\
					if(i &lt; 14 &amp;&amp; xmod4_3 &amp;&amp; ymod4_2)\n\
						return 0.0;\n\
					if(i &lt; 13 &amp;&amp; xmod4_3 &amp;&amp; ymod2 )\n\
						return 0.0;\n\
					if(i &lt; 12 &amp;&amp; xmod2_1 &amp;&amp; ymod2 )\n\
						return 0.0;\n\
					if(i &lt; 11 &amp;&amp; xmod4_2 &amp;&amp; ymod4_1 )\n\
						return 0.0;\n\
					if(i &lt; 10 &amp;&amp; xmod4 &amp;&amp; ymod4_3 )\n\
						return 0.0;\n\
					return 1.0;\n\
				}\n\
			}\n\
		&quot;,
	LUT:  &quot;vec3 LUT(in vec3 color, in sampler2D textureB) {\n\
		 lowp vec3 textureColor = clamp( color, vec3(0.0), vec3(1.0) );\n\
		 mediump float blueColor = textureColor.b * 63.0;\n\
		 mediump vec2 quad1;\n\
		 quad1.y = floor(floor(blueColor) / 8.0);\n\
		 quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\
		 mediump vec2 quad2;\n\
		 quad2.y = floor(ceil(blueColor) / 8.0);\n\
		 quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\
		 highp vec2 texPos1;\n\
		 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\
		 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\
		 highp vec2 texPos2;\n\
		 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\
		 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\
		 lowp vec3 newColor1 = texture2D(textureB, texPos1).xyz;\n\
		 lowp vec3 newColor2 = texture2D(textureB, texPos2).xyz;\n\
		 lowp vec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\
		 return newColor.rgb;\n\
	 }&quot;,
	noise:  &quot;\n\
		float hash(float n) { return fract(sin(n) * 1e4); }\n\
		float hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }\n\
		float noise(float x) {\n\
			float i = floor(x);\n\
			float f = fract(x);\n\
			float u = f * f * (3.0 - 2.0 * f);\n\
			return mix(hash(i), hash(i + 1.0), u);\n\
		}\n\
		float noise(vec2 x) {\n\
			vec2 i = floor(x);\n\
			vec2 f = fract(x);\n\
			float a = hash(i);\n\
			float b = hash(i + vec2(1.0, 0.0));\n\
			float c = hash(i + vec2(0.0, 1.0));\n\
			float d = hash(i + vec2(1.0, 1.0));\n\
			vec2 u = f * f * (3.0 - 2.0 * f);\n\
			return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n\
		}\n\
	&quot;
}

/**
* Returns the first component of this container that is of the same class
* @method configure
* @param {Object} o object with the configuration info from a previous serialization
*/
TextureFX.prototype.configure = function(o)
{
	this.apply_fxaa = !!o.apply_fxaa;
	if(o.fx)
		this.fx = o.fx.concat();
}

TextureFX.prototype.serialize = function()
{
	return { 
		apply_fxaa: this.apply_fxaa,
		fx: this.fx.concat()
	};
}

TextureFX.prototype.getResources = function(res)
{
	//TODO
	return res;
}

TextureFX.prototype.addFX = function( name )
{
	if(!name)
		return;
	if( !TextureFX.available_fx[ name ] )
	{
		console.warn( &quot;TextureFX not found: &quot; + name );
		return;
	}
	this.fx.push({ name: name });
}

TextureFX.prototype.getFX = function(index)
{
	return this.fx[ index ];
}

TextureFX.prototype.moveFX = function( fx, offset )
{
	offset = offset || -1;

	var index = this.fx.indexOf(fx);
	if( index == -1 )
		return;

	this.fx.splice(index,1);
	index += offset;


	if(index &gt;= 0 &amp;&amp; index &lt; this.fx.length)
		this.fx.splice(index,0,fx);
	else
		this.fx.push(fx);
}

TextureFX.prototype.removeFX = function( fx )
{
	for(var i = 0; i &lt; this.fx.length; i++)
	{
		if(this.fx[i] !== fx)
			continue;

		this.fx.splice(i,1);
		return;
	}
}

TextureFX.prototype.applyFX = function( input_texture, output_texture, options )
{
	var color_texture = input_texture;
	var depth_texture = options.depth_texture;

	var fxs = this.fx;

	//shadercode: TODO, do this in a lazy way
	var key = &quot;&quot;;
	var update_shader = true;
	for(var i = 0; i &lt; fxs.length; i++)
		key += fxs[i].name + &quot;|&quot;;
	if(key == this._last_shader_key)
		update_shader = false;
	this._last_shader_key = key;

	var uv_code = &quot;&quot;;
	var color_code = &quot;&quot;;
	var included_functions = {};
	var uniforms_code = &quot;&quot;;
	var texture_slot = 2;

	var uniforms = this._uniforms;
	uniforms.u_viewport[0] = color_texture.width;
	uniforms.u_viewport[1] = color_texture.height;
	uniforms.u_iviewport[0] = 1 / color_texture.width;
	uniforms.u_iviewport[1] = 1 / color_texture.height;
	uniforms.u_aspect = color_texture.width / color_texture.height;
	uniforms.u_random[0] = Math.random();
	uniforms.u_random[1] = Math.random();

	var fx_id = 0;
	for(var i = 0; i &lt; fxs.length; i++)
	{
		var fx = fxs[i];
		fx_id = i;
		var fx_info = TextureFX.available_fx[ fx.name ];
		if(!fx_info)
			continue;
		if(update_shader)
		{
			if(fx_info.functions)
				for(var z in fx_info.functions)
					included_functions[ fx_info.functions[z] ] = true;
			if( fx_info.code )
				color_code += fx_info.code.split(&quot;@&quot;).join( fx_id ) + &quot;;\n&quot;;
			if( fx_info.uv_code )
				uv_code += fx_info.uv_code.split(&quot;@&quot;).join( fx_id ) + &quot;;\n&quot;;
		}
		if(fx_info.uniforms)
			for(var j in fx_info.uniforms)
			{
				var uniform = fx_info.uniforms[j];
				var varname = uniform.name + fx_id;
				if(update_shader)
				{
					uniforms_code += &quot;uniform &quot; + uniform.type + &quot; &quot; + varname + &quot;;\n&quot;;
				}

				if(uniform.type == &quot;sampler2D&quot;)
				{
					uniforms[ varname ] = texture_slot;
					var tex = this.getTexture( fx[j] );
					if(tex)
					{
						tex.bind( texture_slot );
						if(uniform.filter == &quot;nearest&quot;)
						{
							gl.texParameteri( tex.texture_type, gl.TEXTURE_MAG_FILTER, gl.NEAREST );
							gl.texParameteri( tex.texture_type, gl.TEXTURE_MIN_FILTER, gl.NEAREST );
						}
						if(uniform.wrap == &quot;clamp&quot;)
						{
							gl.texParameteri( tex.texture_type, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );
							gl.texParameteri( tex.texture_type, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );
						}
						texture_slot++;
					}
				}
				else
					uniforms[ varname ] = fx[j] !== undefined ? fx[j] : uniform.value;
			}
	}


	var shader = null;
	if(update_shader)
	{
		var functions_code = &quot;&quot;;
		for(var i in included_functions)
		{
			var func = TextureFX.available_functions[ i ];
			if(!func)
			{
				console.error(&quot;TextureFX: Function not found: &quot; + i);
				continue;
			}
			functions_code += func + &quot;\n&quot;;
		}

		var fullcode = &quot;\n\
			#extension GL_OES_standard_derivatives : enable\n\
			precision highp float;\n\
			#define color3 vec3\n\
			#define color4 vec4\n\
			uniform sampler2D u_texture;\n\
			uniform sampler2D u_texture_depth;\n\
			varying vec2 v_coord;\n\
			uniform vec2 u_viewport;\n\
			uniform vec2 u_iviewport;\n\
			uniform float u_aspect;\n\
			uniform vec2 u_random;\n\
			vec2 uv;\n\
			&quot; + uniforms_code + &quot;\n\
			&quot; + functions_code + &quot;\n\
			void main() {\n\
				uv = v_coord;\n\
				vec2 to_center = vec2(0.5) - uv;\n\
				float dist_to_center = length(to_center);\n\
				&quot; + uv_code + &quot;\n\
				vec4 color = texture2D(u_texture, uv);\n\
				float temp = 0.0;\n\
				&quot; + color_code + &quot;\n\
				gl_FragColor = color;\n\
			}\n\
			&quot;;

		this._last_shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, fullcode );
	}

	shader = this._last_shader;

	if(shader.hasUniform(&quot;u_texture_depth&quot;))
		depth_texture.bind(1);

	color_texture.setParameter( gl.TEXTURE_MAG_FILTER, this.filter ? gl.LINEAR : gl.NEAREST );
	color_texture.setParameter( gl.TEXTURE_MIN_FILTER, gl.LINEAR );

	if( this.apply_fxaa )
	{
		if(!this.temp_tex || this.temp_tex.width != gl.viewport_data[2] || this.temp_tex.height != gl.viewport_data[3])
			this.temp_tex = new GL.Texture(gl.viewport_data[2],gl.viewport_data[3]);
		this.temp_tex.drawTo(function(){
			color_texture.toViewport( shader, uniforms );
		});
		var fx_aa_shader = GL.Shader.getFXAAShader();
		fx_aa_shader.setup();

		if(!output_texture)
			this.temp_tex.toViewport( fx_aa_shader );
		else
			this.temp_tex.copyTo( output_texture, fx_aa_shader );
	}
	else
	{
		this.temp_tex = null;
		if(!output_texture)
			color_texture.toViewport( shader, uniforms );
		else
		{
			shader.uniforms( uniforms );
			this.temp_tex.copyTo( output_texture, shader );
		}
	}
}

TextureFX.prototype.getTexture = function( name )
{
	return LS.ResourcesManager.getTexture( name );
}

LS.TextureFX = TextureFX;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
